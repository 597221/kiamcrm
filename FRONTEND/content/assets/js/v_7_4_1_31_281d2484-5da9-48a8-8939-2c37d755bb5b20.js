import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b22.js";import{u as S,f as T,i as y,r as E,a as U,b as u,S as F,c as C,d as L,e as A,g as M,h as k,j as v,k as R,l as D,m as I,n as W,o as b,p as P,q as $,s as G,t as O,v as _,w as j,I as N}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b23.js";import{i as B,a as q}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b19.js";import{u as x}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b24.js";import{E as z,R as J,P as h}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b10.js";import{i as K,a as H}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b25.js";import{i as Q}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b26.js";import{i as V}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b27.js";import{i as X}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b28.js";import{i as Y}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b29.js";import{i as Z}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b30.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b31.js";import{s as tt}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b32.js";import{i as et}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b33.js";import{i as ot}from"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b34.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b7.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b4.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b6.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b8.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b5.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b18.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b9.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b2.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b3.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b35.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b36.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b37.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b38.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b39.js";import"./v_7_4_1_31_281d2484-5da9-48a8-8939-2c37d755bb5b40.js";const at=()=>{const t=document.createElement("script");t.src=chrome.runtime.getURL("whatsapp/index.iife.js"),(document.head||document.documentElement).appendChild(t),t.onload=function(){t.remove()}},st=(t,o,i=5e3)=>{const n=Date.now(),p=()=>{document.querySelector(t)?o():Date.now()-n>=i?(console.error(`Erro: O seletor "${t}" não foi encontrado dentro do tempo limite.`),o()):setTimeout(p,300)};p()};st("#app .app-wrapper-web",()=>{at()});async function it(t,o){return new Promise((i,n)=>{const p=indexedDB.open(t,1);p.onerror=function(s){console.error("Erro ao abrir o banco de dados."),n("Erro ao abrir o banco de dados.")},p.onupgradeneeded=function(s){s.target.result.createObjectStore(o,{keyPath:"id",autoIncrement:!0})},p.onsuccess=function(s){const c=s.target.result,e=c.transaction([o],"readonly").objectStore(o).getAll();e.onsuccess=function(){i(e.result),c.close()},e.onerror=function(){console.error("Erro ao ler os dados da tabela."),n("Erro ao ler os dados da tabela.")}}})}const rt=async()=>{const t=!location.href.includes("https://web.whatsapp");let o=[];if(t)o=await z({stopPropag:!1,action:"getOrderLabels",waitForResponse:!0});else{const i=await it("useOrderLabels","orderLabels");i[0]&&(o=i[0])}x.setState({orderLabels:o})},nt=async()=>{const t=await J("crm");S.setState({crm:t})};rt();nt();(async()=>(await T(),await y(),B(),E.getState().getNotificaoes()))();function ct(t,o){const i=[],n=[],p=new Set(o.flatMap(a=>a.chats.map(e=>`${e.id}|${a.id}`))),s=new Set(t.flatMap(a=>a.chats.map(e=>`${e.id}|${a.id}`))),c=new Map(o.flatMap(a=>a.chats.map(e=>[`${e.id}|${a.id}`,{chat:e,tabId:a.id}]))),m=new Map(t.flatMap(a=>a.chats.map(e=>[`${e.id}|${a.id}`,{chat:e,tabId:a.id}])));for(const a of s)if(!p.has(a)){const e=m.get(a);e&&i.push({...e,chat:{...e.chat,id:h(e.chat.id)}})}for(const a of p)if(!s.has(a)){const e=c.get(a);e&&n.push({...e,chat:{...e.chat,id:h(e.chat.id)}})}return{chatsAdded:i,chatsRemoved:n}}async function g(t,o,i){for(const{chat:n,tabId:p}of t){const s=o.filter(c=>{var r,d,l;const m=c.funil.abas.some(f=>f.id===p),a=n.id.endsWith("@g.us"),e=((l=(d=(r=c.regras)==null?void 0:r.responderGrupos)==null?void 0:d.propriedades)==null?void 0:l.active)!==!1;return m&&c.acionamento.type===i&&(!a||e)});for(const c of s)try{await F(n.id,c)}catch(m){console.error(`❌ Erro ao disparar follow-up: ${c.id} para chat: ${n.id}`,m)}}}function dt(t,o){t.forEach(({chat:i,tabId:n})=>{o.filter(s=>{var e,r,d;const c=s.funil.abas.some(l=>l.id===n),m=i.id.endsWith("@g.us"),a=((d=(r=(e=s.regras)==null?void 0:e.responderGrupos)==null?void 0:r.propriedades)==null?void 0:d.active)!==!1;return c&&s.acionamento.type==="timing"&&(!m||a)}).forEach(s=>{u.getState().addChatToFollowUp(s.id,n,i,"tab")})})}function pt(t,o){t.forEach(({chat:i,tabId:n})=>{o.filter(s=>{var e,r,d;const c=s.funil.abas.some(l=>l.id===n),m=i.id.endsWith("@g.us"),a=((d=(r=(e=s.regras)==null?void 0:e.responderGrupos)==null?void 0:r.propriedades)==null?void 0:d.active)!==!1;return c&&s.acionamento.type==="timing"&&(!m||a)}).forEach(s=>{u.getState().removeChatFromFollowUp(s.id,n,i.id,"tab")})})}function lt(){U.subscribe(async(t,o)=>{if(!t.userTabs||!u.getState().initSubscribeUserTabs)return;const i=t.userTabs||[],n=o.userTabs||[],p=u.getState().FollowUp.filter(r=>r.active);if(p.length===0)return;const s=n.filter(r=>!i.some(d=>d.id===r.id)),{chatsAdded:c,chatsRemoved:m}=ct(i,n),a=s.flatMap(r=>r.chats.map(d=>({chat:d,tabId:r.id}))),e=m.filter(r=>!a.some(d=>d.chat.id===r.chat.id));if(c.length>0){const r=p.filter(l=>l.acionamento.type==="dispararAoEntrar"),d=p.filter(l=>l.acionamento.type==="timing");r.length>0&&await g(c,r,"dispararAoEntrar"),d.length>0&&dt(c,d)}if(e.length>0){const r=p.filter(f=>f.acionamento.type==="dispararAoSair"),d=e.filter(f=>!s.some(w=>w.id===f.tabId));r.length>0&&d.length>0&&await g(d,r,"dispararAoSair");const l=p.filter(f=>f.acionamento.type==="timing");l.length>0&&pt(e,l)}})}window.addEventListener("message",t=>{if(t.data.type==="Ev"&&t.data.action==="chat.update_label"){const o=JSON.parse(t.data.model);o.chat.id={server:"@"+o.chat.id.split("@")[1],user:o.chat.id.split("@")[0],_serialized:o.chat.id},C.getState().dispartWebhook(o.chat.id.user,"labels",{labels:o.labels,type:o.type})}t.data.type==="Ev"&&t.data.action==="chat.presence_change"&&JSON.parse(t.data.model)});L();A();K();H();M();k();Q();V();v();X();R();D();Y();Z();I();lt();tt({useUserLogin:W,useModal:b,useModalOptions:P});$.subscribe(({label:t})=>{chrome.storage.local.get(["initSystem","userTabs","guardaMsg"],o=>{if(!o.initSystem&&o.userTabs.length===0&&o.guardaMsg.length===0){const{openRendertype:i}=b.getState();t.webhook_login_clients.length!==0?i("ModalLeads",!1,void 0,!0):t.chromeStoreID!=="ahiieliljkcgmghicbgidblclkbklmka"&&t.chromeStoreID!=="likkccegmkoonimkjnmgpadngedknpdk"&&i("Modelo_Selecao",!1)}})});window.addEventListener("message",async t=>{t.data.type==="Ev"&&t.data.action==="webpack.full_ready"&&(G(),O(),await q(),et(),await _(),j(),ot(),N())});
